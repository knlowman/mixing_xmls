<?xml version="1.0"?>
<!-- FRE Usage documentation: http://www.gfdl.noaa.gov/fms/fre -->
<!--
Quick start guide:
This xml includes an Ocean-Ice experiment for OM5 based on the configuration
https://gitlab.gfdl.noaa.gov/ogrp/om5dev/om5-config/-/tree/main/OM5

module load fre/bronx-23
fremake -x om5_b11_ryf.xml -p ncrc5.intel23 -t prod OM5_compile
frerun  -x om5_b11_ryf.xml -p ncrc5.intel23 -t prod om5_b11_ryf

Regression testing:
fremake -x om5_b11_ryf.xml -p ncrc5.intel23 -t repro OM5_compile
frerun  -x om5_b11_ryf.xml -p ncrc5.intel23 -t repro -r basic om5_b11_ryf
frerun  -x om5_b11_ryf.xml -p ncrc5.intel23 -t repro -r rts om5_b11_ryf

XML formatting/linting:
xmllint -output om5_b11_ryf.xml -format om5_b11_ryf.xml
-->
<experimentSuite xmlns:xi="http://www.w3.org/2001/XInclude" rtsVersion="4">
  <property name="RELEASE" value="2025.02"/>
  <!-- git tag for general component source code-->
  <property name="FMS_GIT_TAG" value="$(RELEASE)"/>
  <!-- git tag for shared source code -->
  <property name="CPL_GIT_TAG" value="$(RELEASE)"/>
  <!-- git tag for coupler source code -->
  <property name="NULL_TAG" value="$(RELEASE)"/>
  <!-- git tag for atmos_null and land_null source code -->
  <property name="ICE_PARAM_TAG" value="2024.02"/>
  <!-- git tag for ice_param source code -->
  <property name="OM5_DATE" value="20250521"/>
  <!-- arbitrary string for identifying OM5-config clone-->
  <property name="OM5_REPO" value="ogrp/om5dev"/>
  <!-- Gitlab repository to use for OM5-->
  <property name="OM5_GIT_TAG" value="om5_b11"/>
  <!-- git hash/tag/branch for OM5-config repo -->
  <property name="FRE_STEM" value="fre_om5/FMS$(RELEASE)_om5_$(OM5_DATE)"/>
  <!-- customize as needed -->
  <!-- Please make sure to change "YOURGROUPLETTER" to your group, such as b, f, g, m, o... -->
  <!-- Note that to run on c6 you may need to specify c6 specific account identifier -->
  <property name="GFDL_GROUP" value="gfdl_o"/>
  <!-- Replace YOURGROUPLETTER with GFDL group letter -->
  <!--Production run properties. Users can modify these according to their need and/or performance analysis-->
  <property name="PROD_SIMTIME" value="20"/>
  <!--Post-processing  chunk lengths -->
  <property name="CHUNK_LENGTH_A" value="5yr"/>
  <property name="CHUNK_LENGTH_B" value="20yr"/>
  <property name="ANALYSIS_SWITCH" value="on"/>
  <!-- on/off switch for ATM/LND analysis -->
  <!--Start year of PP -->
  <property name="PP_START_YEAR" value="1958"/>
  <!--Use these values for CORE2 dynamic forcing runs -->
  <property name="FRE_VERSION" value="bronx-23"/>
  <!-- fre version to be used -->
  <property name="ProjectID" value="CMIP6"/>
  <!-- database top level -->
  <!--Users need not change the following properties -->
  <property name="reference_tag" value="FMS2024.02_om5_20240819"/>
  <!-- Reference answers for frecheck -->
  <!-- The following properties are for testing/debugging purposes and should normally be empty-->
  <property name="SRC_EXEC_ROOT" value="$HOME"/>
  <!-- top-level location to checkout source code and build executable -->
  <property name="MODIFIER" value=""/>
  <property name="DEBUGLEVEL" value=""/>
  <property name="PLATINFO" value=""/>
  <!--This is necessary only if you want to run exact same experiment on multiple platforms-->
  <!-- git hash/tag/branch for MOM6 src repo, leave empty unless you want to test specific branch/tags of MOM6 and SIS2 -->
  <property name="MOM6_GIT_TAG" value=""/>
  <!-- git hash/tag/branch for MOM6 src repo -->
  <property name="SIS2_GIT_TAG" value=""/>
  <!-- git hash/tag/branch for SIS2 src repo -->
  <!--legecy properties-->
  <property name="BUILD_DATE" value=""/>
  <property name="AWG_INPUT_HOME_GAEA" value=""/>
  <property name="AWG_INPUT_HOME_GFDL" value=""/>
  <property name="append_to_setup_csh" value="set fyear=1958"/>
  <!--The start year of forcing dataseti. FRE hack to set fyear.-->
  <property name="PROG_MAIN" value="coupler/coupler_main.o"/>
  <setup>
    <xi:include href="xml_include/xml_building_blocks/platforms.xml" xpointer="xpointer(//freInclude/platform[@name='ncrc5.intel23'])"/>
    <xi:include href="xml_include/xml_building_blocks/platforms.xml" xpointer="xpointer(//freInclude/platform[@name='gfdl.ncrc5-intel23'])"/>
    <xi:include href="xml_include/xml_building_blocks/platforms.xml" xpointer="xpointer(//freInclude/platform[@name='ncrc6.intel23'])"/>
    <xi:include href="xml_include/xml_building_blocks/platforms.xml" xpointer="xpointer(//freInclude/platform[@name='gfdl.ncrc6-intel23'])"/>
  </setup>
  <!--JRA dataset location. There are used in awg_include/xml_building_blocks/om4_common.xml-->
  <property name="JRA_dataset" value="$(gfdlO_pdata)/datasets/reanalysis/JRA55-do/v1.5.0"/>
  <property name="JRA_dataset_p25" value="$(gfdlO_pdata)/datasets/OM5_025/JRA_runoff_v20240410"/>
  <property name="JRA_version" value="1-5-0"/>
  <!--= COMPILE =-->
  <property name="LIBS_ROOT" value="OM5_compile$(MODIFIER)"/>
  <!--The property MOM6_EXAMPLES should point to the om5-config directory that is checked out. It is needed by MOM6/SIS2 to access its input data files-->
  <property name="MOM6_EXAMPLES" value="$root/$(LIBS_ROOT)/src/mom6"/>
  <experiment name="OM5_compile">
    <description>
Make the executable for ocean-ice experiments.
      </description>
    <component name="fms" paths="FMS">
      <source versionControl="git" root="https://github.com/NOAA-GFDL">
        <codeBase version="$(FMS_GIT_TAG)"> FMS.git </codeBase>
      </source>
      <compile>
        <cppDefs>-Duse_libMPI -Duse_netCDF $(F2003_FLAGS) -DMAXFIELDMETHODS_=400</cppDefs>
      </compile>
    </component>
    <component name="mom6" requires="fms" paths="mom6/src/MOM6/config_src/{infra/FMS2,memory/dynamic_symmetric,drivers/FMS_cap,external} mom6/src/MOM6/src/{*,*/*}/">
      <!--source versionControl="git" root="https://gitlab.gfdl.noaa.gov/ogrp/om5dev"-->
      <source versionControl="git" root="https://gitlab.gfdl.noaa.gov/$(OM5_REPO)">
        <codeBase version="main"> om5-config.git </codeBase>
        <csh><![CDATA[
	  mv om5-config mom6
	  pushd mom6
	  git checkout $(OM5_GIT_TAG)
	  git submodule update --recursive --init src/MOM6 src/SIS2 src/icebergs
          (cd src/icebergs && git checkout dev/gfdl)
          if ("$(MOM6_GIT_TAG)" != "") then
            echo WARNING: Checking out a commit. This might not be needed/desired in the future.
            (cd src/MOM6 && git checkout $(MOM6_GIT_TAG))
          endif
          if ("$(SIS2_GIT_TAG)" != "") then
            echo WARNING: Checking out a commit. This might not be needed/desired in the future.
            (cd src/SIS2 && git checkout $(SIS2_GIT_TAG))
          endif

          popd

          pushd mom6
          set platform_domain = `perl -T -e "use Net::Domain(hostdomain) ; print hostdomain"`
	  if ("${platform_domain}" =~ *"c5"* ) then
            ln -s /gpfs/f5/gfdl_o/world-shared/datasets .datasets
	  else if ("${platform_domain}" =~ *"c6"* ) then
            ln -s /gpfs/f6/gfdl_o/world-shared/datasets .datasets
          endif
          popd

          test -e mom6/.datasets
          if ($status != 0) then
            echo ""; echo "" ; echo "   WARNING:  .datasets link in MOM6 examples directory is invalid"; echo ""; echo ""
          endif

        ]]></csh>
      </source>
      <compile>
        <cppDefs><![CDATA[ $(F2003_FLAGS) -DMAX_FIELDS_=100 -DNOT_SET_AFFINITY -D_USE_MOM6_DIAG -D_USE_GENERIC_TRACER  -DUSE_PRECISION=2 -D_FILE_VERSION="'"`git-version-string $<`"'" ]]></cppDefs>
        <makeOverrides>OPENMP=""</makeOverrides>
        <!--openmp switch for MOM6 may cause crash -->
      </compile>
    </component>
    <component name="sis2" paths="mom6/src/SIS2/config_src/dynamic_symmetric mom6/src/SIS2/config_src/external/Icepack_interfaces mom6/src/SIS2/src mom6/src/icebergs/src ice_param" requires="fms mom6" includeDir="$root/$(LIBS_ROOT)/src/mom6/src/MOM6/src/framework">
      <source versionControl="git" root="https://github.com/NOAA-GFDL">
        <codeBase version="$(ICE_PARAM_TAG)"> ice_param.git </codeBase>
      </source>
      <compile>
        <cppDefs><![CDATA[$(F2003_FLAGS) -DUSE_FMS2_IO -D_FILE_VERSION="'"`git-version-string $<`"'"]]></cppDefs>
      </compile>
    </component>
    <component name="land_null" paths="land_null" requires="fms">
      <source versionControl="git" root="https://github.com/NOAA-GFDL">
        <codeBase version="$(NULL_TAG)"> land_null.git </codeBase>
      </source>
    </component>
    <component name="atmos_null" paths="atmos_null" requires="fms">
      <source versionControl="git" root="https://github.com/NOAA-GFDL">
        <codeBase version="$(NULL_TAG)"> atmos_null.git </codeBase>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) </cppDefs>
      </compile>
    </component>
    <component name="coupler" paths="coupler/full coupler/shared" requires="fms land_null atmos_null sis2 mom6">
      <source versionControl="git" root="https://github.com/NOAA-GFDL">
        <codeBase version="main"> coupler.git </codeBase>
        <csh><![CDATA[
          ( cd coupler && git checkout $(CPL_GIT_TAG) )
          ]]></csh>
      </source>
      <compile>
        <cppDefs><![CDATA[$(F2003_FLAGS) -D_USE_LEGACY_LAND_ -Duse_AM3_physics -D_FILE_VERSION="'"`git-version-string $<`"'"]]></cppDefs>
      </compile>
    </component>
  </experiment>
  <!--**************************************************************************-->
  <!--***************************** OM5 experiments ****************************-->
  <!--**************************************************************************-->
  <experiment name="om5_b11_ryf" inherit="OM5_compile$(MODIFIER)">
    <description>
global 1/4 degree ocean_ice experiment
regridded runoff and salinity
JRA55do1-5 repeat year forcing data (May 1990 to April 1991)
No additional diurnal cycle imposed
    </description>
    <input>
      <namelist name="coupler_nml">
       months = $months,
       days   = $days,
       current_date = 1,1,1,0,0,0,
       hours = 0
       minutes = 0
       seconds = 0
       calendar = 'julian',
       dt_cpld  = 1800,
       dt_atmos = 1800,
       do_atmos = .false.,
       do_land = .false.,
       do_ice = .true.,
       do_ocean = .true.,
       atmos_npes = 0,
       concurrent = .false.
       use_lag_fluxes=.false.
       atmos_nthreads = $atm_threads
       ocean_nthreads = $ocn_threads
      </namelist>
      <namelist name="xgrid_nml">
       make_exchange_reproduce = .true.
       interp_method = 'second_order'
      </namelist>
      <dataFile label="gridSpec" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(gfdlO_pdata)/datasets/OM5_025/ocean_mosaic_v20240410.tar</dataSource>
        <dataSource site="gfdl">/archive/gold/datasets/OM5_025/ocean_mosaic_v20240410.tar</dataSource>
      </dataFile>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <!-- initialize sea ice from year 1978 of this run: /archive/Olga.Sergienko/fre_om5/FMS2023.01_om5_20231122/om5_b03_standard_GEBCO_BMv3Ant/gfdl.ncrc5-intel23-prod/restart/19780101.tar -->
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/seaiceInitCond_v20240410.tar</dataSource>
      </dataFile>
      <dataFile label="namelist" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_EXAMPLES)/OM5/input.nml</dataSource>
      </dataFile>
      <namelist name="SIS_input_nml">
         output_directory = './',
         input_filename = '$restart_flag_SIS2'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/SIS_input','INPUT/SIS_layout','INPUT/SIS_override'
      </namelist>
      <namelist name="MOM_input_nml">
         output_directory = './',
         input_filename = '$restart_flag_MOM6'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/MOM_input','INPUT/MOM_layout','INPUT/MOM_saltrestore','INPUT/MOM_override'
      </namelist>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/MOM_input</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/SIS_input</dataSource>
      </dataFile>
      <!--common setup-->
      <xi:include xpointer="xpointer(//freInclude[@name='OM5_common']/input/node())"/>
      <!--OM5 Input datasets-->
      <xi:include xpointer="xpointer(//freInclude[@name='OM5_data']/input/node())"/>
      <!--common setup for JRA forcing dataset and data_table-->
      <xi:include xpointer="xpointer(//freInclude[@name='JRA_data_table']/input/node())"/>
      <!--append the resolution dependent runoff override-->
      <dataTable order="append">
#JRA runoff
"ICE" , "runoff"        , "friver"      , "./INPUT/JRA_friver_1440x1161.nc", "none" ,  1.0
"ICE" , "calving"       , "licalvf"     , "./INPUT/JRA_licalvf_1440x1161.nc", "none" ,  1.0
     </dataTable>
      <dataFile label="fieldTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_EXAMPLES)/OM5/field_table</dataSource>
      </dataFile>
      <diagTable>
$name
$baseDate
     </diagTable>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_EXAMPLES)/OM5/diag_table.OM5</dataSource>
        <dataSource site="gfdl">$(includeDir)/diag_table/diag_table.OM5</dataSource>
      </dataFile>
      <!--MOM_overrides-->
      <csh><![CDATA[
cat > $work/INPUT/MOM_override << MOM_OVERRIDE_EOF
MOM_OVERRIDE_EOF

cat > $work/INPUT/SIS_override << SIS_OVERRIDE_EOF
SIS_OVERRIDE_EOF
     ]]></csh>
      <!---->
    </input>
    <runtime>
      <production simTime="$(PROD_SIMTIME)" units="years">
        <segment simTime="12" units="months"/>
        <resources jobWallclock="16:00:00" segRuntime="3:00:00">
          <ocn ranks="2985" threads="1" layout="60,72" io_layout="1,4" mask_table="mask_table.1335.60x72"/>
          <ice layout="60,72" io_layout="1,4" mask_table="mask_table.1335.60x72"/>
        </resources>
      </production>
      <regression name="basic">
        <run months="1">
          <resources jobWallclock="01:30:00">
            <ocn ranks="2985" threads="1" layout="60,72" io_layout="1,4" mask_table="mask_table.1335.60x72"/>
            <ice layout="60,72" io_layout="1,4" mask_table="mask_table.1335.60x72"/>
          </resources>
        </run>
      </regression>
      <regression name="rts">
        <run days="15 16">
          <resources jobWallclock="01:30:00">
            <ocn ranks="2985" threads="1" layout="60,72" io_layout="1,4" mask_table="mask_table.1335.60x72"/>
            <ice layout="60,72" io_layout="1,4" mask_table="mask_table.1335.60x72"/>
          </resources>
        </run>
        <!--the following should reproduce eachother but not the basic because basic uses mask_table-->
        <run days="10">
          <resources jobWallclock="01:30:00">
            <ice layout="45,36" io_layout="1,4" mask_table="MOM_mask_table"/>
            <ocn ranks="1620" threads="1" layout="45,36" io_layout="1,4" mask_table="MOM_mask_table"/>
          </resources>
        </run>
        <run days="10">
          <resources jobWallclock="01:30:00">
            <ice layout="72,36" io_layout="1,4" mask_table="MOM_mask_table"/>
            <ocn ranks="2592" threads="1" layout="72,36" io_layout="1,4" mask_table="MOM_mask_table"/>
          </resources>
        </run>
      </regression>
      <regression name="ci">
        <run days="1">
          <resources jobWallclock="01:30:00">
            <ice layout="32,16" io_layout="1,4" mask_table="MOM_mask_table"/>
            <ocn ranks="512" threads="1" layout="32,16" io_layout="1,4" mask_table="MOM_mask_table"/>
          </resources>
        </run>
      </regression>
      <regression name="debug">
        <run days="2">
          <resources jobWallclock="01:30:00">
            <ice layout="32,16" io_layout="1,4" mask_table="MOM_mask_table"/>
            <ocn ranks="512" threads="1" layout="32,16" io_layout="1,4" mask_table="MOM_mask_table"/>
          </resources>
        </run>
      </regression>
      <regression name="timing">
        <run months="1">
          <resources jobWallclock="01:30:00">
            <!--SYPDc5= 7.91808-->
            <ice layout="45,72" io_layout="1,4" mask_table="mask_table.956.45x72"/>
            <ocn ranks="2284" threads="1" layout="45,72" io_layout="1,4" mask_table="mask_table.956.45x72"/>
          </resources>
        </run>
        <run months="1">
          <resources jobWallclock="01:30:00">
            <!--SYPDc5= 7.48837-->
            <ocn ranks="2280" threads="1" layout="90,36" io_layout="1,4" mask_table="mask_table.960.90x36"/>
            <ice layout="90,36" io_layout="1,4" mask_table="mask_table.960.90x36"/>
          </resources>
        </run>
        <run months="1">
          <resources jobWallclock="01:30:00">
            <!--SYPD= 9.82645-->
            <ocn ranks="2985" threads="1" layout="60,72" io_layout="1,4" mask_table="mask_table.1335.60x72"/>
            <ice layout="60,72" io_layout="1,4" mask_table="mask_table.1335.60x72"/>
          </resources>
        </run>
        <run months="1">
          <resources jobWallclock="01:30:00">
            <!--SYPD= 10.0022-->
            <ocn ranks="4320" threads="1" layout="60,72" io_layout="1,4" mask_table="MOM_mask_table"/>
            <ice layout="60,72" io_layout="1,4" mask_table="MOM_mask_table"/>
          </resources>
        </run>
        <run months="1">
          <resources jobWallclock="01:30:00">
            <!--SYPD= 13.6092-->
            <ocn ranks="4393" threads="1" layout="90,72" io_layout="1,4" mask_table="mask_table.2087.90x72"/>
            <ice layout="90,72" io_layout="2,4" mask_table="mask_table.2087.90x72"/>
          </resources>
        </run>
        <run months="1">
          <resources jobWallclock="01:30:00">
            <!--SYPD= 10.7957-->
            <ocn ranks="3337" threads="1" layout="90,54" io_layout="5,2" mask_table="mask_table.1523.90x54"/>
            <ice layout="90,54" io_layout="5,2" mask_table="mask_table.1523.90x54"/>
          </resources>
        </run>
        <!--The following 72,72 config requires atmos_model_nml and land_model_nml to be defined in the xml as follows
    so that they have a mask_table. Otherwise this config crashes with error message
    FATAL atmos_null domain extents must be positive definite
      <namelist name="atmos_model_nml">
 layout     = $atm_layout
 mask_table = 'INPUT/$atm_mask_table'
      </namelist>
      <namelist name="land_model_nml">
 layout     = $lnd_layout
 mask_table = 'INPUT/$lnd_mask_table'
      </namelist>
-->
        <run months="1">
          <resources jobWallclock="01:30:00">
            <!--SYPD= 11.7959-->
            <ice layout="72,72" io_layout="4,4" mask_table="mask_table.1637.72x72"/>
            <ocn ranks="3547" threads="1" layout="72,72" io_layout="1,4" mask_table="mask_table.1637.72x72"/>
            <lnd layout="72,72" mask_table="mask_table.1637.72x72"/>
            <atm ranks="3547" threads="1" layout="72,72" mask_table="mask_table.1637.72x72"/>
          </resources>
        </run>
        <run months="1">
          <resources jobWallclock="01:30:00">
            <!--SYPD= 11.8456-->
            <ice layout="72,72" io_layout="4,4" mask_table="MOM_mask_table"/>
            <ocn ranks="5184" threads="1" layout="72,72" io_layout="1,4" mask_table="MOM_mask_table"/>
          </resources>
        </run>
      </regression>
      <reference restart="$(REFERENCE)/archive/1x1m0d_2432x1o/restart/19000201.tar"/>
    </runtime>
    <postProcess>
      <csh><![CDATA[
         cd $work
         #Make a directory to trick FRE to pick up and archive in ascii
         mkdir extra.results
         mv *velocity_truncations MOM_parameter_doc* SIS_parameter_doc* seaice.stats* ocean.stats* extra.results/
         cp diag_table extra.results/.
         cp $scriptName extra.results/runscript.csh
         #When the ocean uses a mask_table the ocean_static.nc file produced by the model run has holes in coordinates (geolon,geolat)
         #This causes problems for ferret and python tools for analysis.
         #Copy a non-masked version of ocean_static.nc to be saved as a history file to be used by the analysis scipts .
         cp $work/INPUT/ocean_static_no_mask_table.nc $work/
      ]]></csh>
      <refineDiag script="/home/mdteam/DET/analysis/vitals/gfdlvitals_refineDiag_om5.latest.csh"/>
      <xi:include href="xml_include/xml_building_blocks/om5_postprocess.xml" xpointer="xpointer(//freInclude[@name='OM5_postprocess']/postProcess/node())"/>
      <xi:include href="xml_include/xml_building_blocks/om5_postprocess.xml" xpointer="xpointer(//freInclude[@name='OM5_postprocess_1x1']/postProcess/node())"/>
      <xi:include href="xml_include/xml_building_blocks/om5_postprocess.xml" xpointer="xpointer(//freInclude[@name='OM5_sections_postprocess']/postProcess/node())"/>
    </postProcess>
  </experiment>
  <freInclude name="OM5_data">
    <input>
      <dataFile label="input" target="INPUT/ocean_static_no_mask_table.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/INPUT/ocean_static_nomsk_v20240410.nc</dataSource>
      </dataFile>
      <!--grid dependent datasets that should be bundled within gridSpec tar file-->
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/INPUT/seawifs-clim-1997-2010_v20240410.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/INPUT/salt_restore_JRA_v20240410.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/INPUT/tidal_amplitude_v20240410.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/INPUT/geothermal_davies2013_v1_v20240410.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/ocean_mosaic_v20240410_unpacked/mask_table.1335.60x72</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/INPUT/layer_coord.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/MOM_saltrestore</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/INPUT/MOM_channels_global_025</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/INPUT/hycom1_75_800m.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/INPUT/woa13_decav_ptemp_monthly_fulldepth_01.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/INPUT/woa13_decav_s_monthly_fulldepth_01.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/INPUT/diag_rho2.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/INPUT/diag_rho2_74layer.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/INPUT/diag_rho0_60layer.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/OM5/INPUT/diag_z3.nc</dataSource>
      </dataFile>
      <!--repeat year forcing files-->
      <dataFile label="input" target="INPUT/JRA_huss.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/RYF/huss_input4MIPs_atmosphericState_OMIP_MRI-JRA55-do-1-5-0_00020101-00021231.padded.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/JRA_prra.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/RYF/prra_input4MIPs_atmosphericState_OMIP_MRI-JRA55-do-1-5-0_00020101-00021231.padded.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/JRA_prsn.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/RYF/prsn_input4MIPs_atmosphericState_OMIP_MRI-JRA55-do-1-5-0_00020101-00021231.padded.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/JRA_psl.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/RYF/psl_input4MIPs_atmosphericState_OMIP_MRI-JRA55-do-1-5-0_00020101-00021231.padded.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/JRA_rlds.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/RYF/rlds_input4MIPs_atmosphericState_OMIP_MRI-JRA55-do-1-5-0_00020101-00021231.padded.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/JRA_rsds.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/RYF/rsds_input4MIPs_atmosphericState_OMIP_MRI-JRA55-do-1-5-0_00020101-00021231.padded.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/JRA_tas.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/RYF/tas_input4MIPs_atmosphericState_OMIP_MRI-JRA55-do-1-5-0_00020101-00021231.padded.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/JRA_uas.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/RYF/uas_input4MIPs_atmosphericState_OMIP_MRI-JRA55-do-1-5-0_00020101-00021231.padded.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/JRA_vas.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/RYF/vas_input4MIPs_atmosphericState_OMIP_MRI-JRA55-do-1-5-0_00020101-00021231.padded.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/JRA_friver_1440x1161.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/RYF/friver_input4MIPs_atmosphericState_OMIP_MRI-JRA55-do-1-5-0_00020101-00021231.padded.v20240410.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/JRA_licalvf_1440x1161.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(gfdlO_pdata)/datasets/OM5_025/RYF/licalvf_input4MIPs_atmosphericState_OMIP_MRI-JRA55-do-1-5-0_00020101-00021231.padded.v20240410.nc</dataSource>
      </dataFile>
    </input>
  </freInclude>
  <freInclude name="OM5_common">
    <input>
      <csh type="always"><![CDATA[
#------------------------------------------
## Find out whether to restart.

if ( $currentSeg == 1 ) then
   set restart_flag_MOM6 = 'n'
   set restart_flag_SIS2 = 'r'
   #Take current date from coupler_nml for each cycle
   if(-e $work/INPUT/coupler.res ) \rm -rf $work/INPUT/coupler.res
else
   set restart_flag_MOM6 = 'r'
   set restart_flag_SIS2 = 'r'
   #Because of a technical issue FRE does not delete old uncombined restarts before copying the new ones for the next segment
   #The INPUT/ ends up with inconsistent restart files which at best cause the model to crash right away.
   if(-e $work/INPUT/MOM.res.nc.0000 ) \rm -rf $work/INPUT/MOM.res*.nc
endif

#Its not clear why SIS_fixed_initialization.F90 is called MOM6 looks for topog.nc while TOPO_FILE = "ocean_topog.nc" in MOM_input
ln -s $work/INPUT/ocean_topog.nc $work/INPUT/topog.nc

touch $work/INPUT/MOM_override
touch $work/INPUT/SIS_override
touch $work/INPUT/MOM_layout
touch $work/INPUT/SIS_layout

# Record the job stdout location for later use timings database
cat >> $HOME/frejobs_stdout <<EOF_frejobs
$stdoutDir/$FRE_JOBID
EOF_frejobs



cat > $work/INPUT/MOM_layout << MOM_LAYOUT_EOF
#override IO_LAYOUT = $ocn_io_layout
#override LAYOUT    = $ocn_layout
#override MASKTABLE = $ocn_mask_table
MOM_LAYOUT_EOF

cat > $work/INPUT/SIS_layout << SIS_LAYOUT_EOF
#override IO_LAYOUT = $ice_io_layout
#override LAYOUT    = $ice_layout
#override MASKTABLE = $ice_mask_table
SIS_LAYOUT_EOF

#cat > $work/INPUT/SIS_diurnal << SIS_diurnal_EOF
#ADD_DIURNAL_SW = True ! This must ONLY be used in the ice-ocean mode if forcing is not diurnal (e.g. CORE), NOT fully coupled mode.
#SIS_diurnal_EOF

# Copy some files to GFDL that are needed for postprocessing (waiting for FRE to do this for us)
if ( $?flagOutputXferOn && $?flagOutputPostProcessOn && $currentSeg == 1 ) then
    #We should transfer the diag_table file to gfdl needed for PP
    #gcp --batch -cd --sync $(MOM6_EXAMPLES)/OM5/diag_table.CM4X gfdl:$(NB_ROOT)/om5-config/OM5/diag_table.CM4X
    #The above gcp is not working on c5 compute nodes at this time.
    #Here is an alternative trick to make fre transfer the file. Anything under  $(includeDir) gets transfered by fre:
    #Also note that $(includeDir) must be defined in both the ncrc5 and gfdl sections in platforms.xml.
    mkdir -p $(includeDir)/diag_table/
    cp $(MOM6_EXAMPLES)/OM5/diag_table.CM4X $(includeDir)/diag_table/
    cp $(MOM6_EXAMPLES)/OM5/diag_table.sections $(includeDir)/diag_table/
endif

set comment=`scontrol show job $SLURM_JOB_ID | grep "Comment" | cut -f 2 -d '='`
scontrol update jobID=$SLURM_JOB_ID comment=$comment,om5dev

cd $work

      ]]></csh>
    </input>
  </freInclude>
  <freInclude name="JRA_data_table">
    <input>
      <dataTable>
 "ATM", "p_surf",             "psl",      "./INPUT/JRA_psl.nc",     "bilinear",   1.0
 "ATM", "p_bot",              "psl",      "./INPUT/JRA_psl.nc",     "bilinear",   1.0
 "ATM", "t_bot",              "tas",      "./INPUT/JRA_tas.nc",     "bilinear",   1.0
 "ATM", "sphum_bot",          "huss",     "./INPUT/JRA_huss.nc",    "bilinear",   1.0
 "ATM", "u_bot",              "uas",      "./INPUT/JRA_uas.nc",     "bicubic",    1.0
 "ATM", "v_bot",              "vas",      "./INPUT/JRA_vas.nc",     "bicubic",    1.0
 "ATM", "z_bot",              "",         "",                       "bilinear",  10.0
 "ATM", "gust",               "",         "",                       "bilinear",   1.0e-4
 "ICE", "lw_flux_dn",         "rlds",     "./INPUT/JRA_rlds.nc",    "bilinear",   1.0
 "ICE", "sw_flux_vis_dir_dn", "rsds",     "./INPUT/JRA_rsds.nc",    "bilinear",   0.285
 "ICE", "sw_flux_vis_dif_dn", "rsds",     "./INPUT/JRA_rsds.nc",    "bilinear",   0.285
 "ICE", "sw_flux_nir_dir_dn", "rsds",     "./INPUT/JRA_rsds.nc",    "bilinear",   0.215
 "ICE", "sw_flux_nir_dif_dn", "rsds",     "./INPUT/JRA_rsds.nc",    "bilinear",   0.215
 "ICE", "lprec",              "prra",     "./INPUT/JRA_prra.nc",    "bilinear",   1.0
 "ICE", "fprec",              "prsn",     "./INPUT/JRA_prsn.nc",    "bilinear",   1.0
 "ICE", "dhdt",               "",         "",                       "none",      80.0
 "ICE", "dedt",               "",         "",                       "none",       2.0e-6
 "ICE", "drdt",               "",         "",                       "none",      10.0
      </dataTable>
    </input>
  </freInclude>
</experimentSuite>
